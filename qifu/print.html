<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç¥ˆç¦èµ„æ–™æ‰“å°</title>
  <style>
    @page {
      size: A4;
      margin: 10mm 15mm 15mm 15mm; /* ğŸ‘ˆ ä¸Šè¾¹è·å‡å°‘ */
    }

    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #fff8e7; /* âœ¨ç±³é»„è‰²ï¼ŒæŸ”å’Œä¸åˆºçœ¼ */
      margin: 5mm auto 0 auto; /* ğŸ‘ˆ é¡¶éƒ¨ç©ºéš™æ›´å° */
      max-width: 780px;
      color: #000;
      padding: 0 10px;
    }

    .header-block {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      margin-top: -5px; /* ğŸ‘ˆ å†å¾€ä¸Šæ‹‰ä¸€ç‚¹ */
    }

    .logo {
      width: 120px;
      height: auto;
      object-fit: contain;
    }

    .header-center {
      flex: 1;
      text-align: center;
    }

    .header-center h2 {
      margin: 0;
      font-size: 28px;
      line-height: 1.4;
    }

    .header-line {
      font-size: 12px;
      line-height: 1.2;
      margin: 1px 0;
    }

    .dharma-title {
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      margin: 5px 0 10px;
    }

    .info {
      display: flex;
      gap: 40px;
      font-size: 14px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-print {
      text-align: right;
      margin: 10px 0 5px;
    }

    .btn-print button {
      padding: 6px 12px;
      font-size: 14px;
      background: #d0021b;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
      vertical-align: middle;
      height: 30px;
      line-height: 1.2;
      word-break: break-word;
      white-space: normal;
    }

    .footer-wrap {
      margin-top: 20px;
      page-break-inside: avoid;
    }

    .blessing {
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      line-height: 1.5;
      margin-bottom: 10px;
      page-break-inside: avoid;
    }

    .totals {
      font-size: 14px;
      line-height: 1.6;
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .total-row {
      display: flex;
      font-size: 13px;
      line-height: 1.3;
      margin-bottom: 2px;
      white-space: nowrap;
      justify-content: flex-end;
    }

    .total-row .item {
      text-align: left;
      min-width: 90px;
    }

    .total-row .formula {
      text-align: left;
      min-width: 140px;
      padding-left: 10px;
      color: #555;
    }

    .total-row .value {
      text-align: right;
      min-width: 80px;
      font-variant-numeric: tabular-nums;
      padding-left: 10px;
    }

    .total-final {
      font-weight: 700;
      font-size: 15px;
      line-height: 1.3;
      margin-top: 2px;
    }

    @media print {
      .btn-print {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="header-block">
    <img src="left-logo.jpg" class="logo" alt="å·¦ Logo">
    <div class="header-center">
      <h2>çœŸä½›å®—è¯—å·«å¦™ç†é›·è—å¯º</h2>
      <div class="header-line">Persatuan Miao Li Tang Sibu</div>
      <div class="header-line">No.22N, Taman Damai, Off Brooke Drive 33,</div>
      <div class="header-line">Jalan Tun Abang Haji Openg, 96000, Sibu, Sarawak, Malaysia.</div>
      <div class="header-line">Tel: 6-084-342986 / 013-980-4461</div>
      <div class="header-line">Fax: 6-084-319961</div>
    </div>
    <img src="right-logo.jpg" class="logo" alt="å³ Logo">
  </div>

  <div class="dharma-title" id="dharmaTypeTitle">æ³•ä¼šç™»è®°è¡¨</div>

  <div class="info">
    <span><strong>è¡¨æ ¼å¡«å†™è€…ï¼š</strong><span id="mainName"></span></span>
    <span><strong>æ‰‹æœºå·ï¼š</strong><span id="phoneNumber"></span></span>
  </div>

  <div class="btn-print">
    <button onclick="window.print()">ğŸ–¨ï¸ æ‰“å°è¡¨å•</button>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:20%">å§“å</th>
        <th style="width:45%">ç°å±…åœ°å€</th>
        <th style="width:8.75%">ç¥ˆç¦ä»¤ç‰Œ</th>
        <th style="width:8.75%">å°æŠ¤æ‘©ç‰‡</th>
        <th style="width:8.75%">çº¸é‡‘ 3</th>
        <th style="width:8.75%">çº¸é‡‘ 6</th>
      </tr>
    </thead>
    <tbody id="prayerBody"></tbody>
  </table>

  <div class="footer-wrap">
    <div class="blessing">
      ä¸Šåˆ—å–„ä¿¡ï¼Œä¸€å¿ƒè‡³è¯šï¼Œè™”è¯šä¾›å…»ï¼Œä»°å©çœŸä½›å®—æ ¹æœ¬ä¼ æ‰¿ä¸Šå¸ˆåœ£å°Šè²ç”Ÿæ´»ä½›åŠè¯¸ä½›è©è¨ï¼Œçµå…‰åŠ æŒï¼Œ<br>
      ä¸šéšœé€Ÿé™¤ã€ç¾å„åŒ–è§£ã€ç¦æ…§å¢é•¿ã€èº«å¿ƒå¥åº·ã€è¿ç¨‹äº¨é€šã€ç¦å¯¿å¢å»¶ã€ä¸‡äº‹å¦‚æ„ã€å®‰å±…ä¹ä¸šã€ä¿®è¡Œæˆå°±ã€<br>
      æ˜å¿ƒè§æ€§ã€ä¸€åˆ‡å…‰æ˜ã€å¿ƒæ„¿åœ†æ»¡ï¼Œä¼ä¹æ…ˆæ‚²ï¼Œè™”è¯šæ˜¯ç¥·ã€‚
    </div>
    <hr style="border-top: 1px solid #000; margin: 6px 0;">
    <div class="totals" id="totalBox"></div>
  </div>

  <script>
    window.addEventListener("message", function (event) {
      let data;
      try {
        data = JSON.parse(event.data);
      } catch {
        alert("âŒ æ— æ•ˆæ•°æ®æ ¼å¼");
        return;
      }

      const $ = id => document.getElementById(id);
      const fillCell = val => `<div style="min-height:1em">${val ? val : '&nbsp;'}</div>`;

      $("mainName").textContent = data.mainName || "";
      $("phoneNumber").textContent = data.phoneNumber || "";

      const dharmaMap = {
        "ä¸­å…ƒèŠ‚": "ä¸­å…ƒèŠ‚ç™½è²èŠ±ç‹è—å¯†å¼æŠ¤æ‘© æ³•ä¼šã€ç¥ˆç¦ã€‘ç™»è®°è¡¨",
        "æ¸…æ˜èŠ‚": "åœ°è—è¶…åº¦æ³•ä¼šç™»è®°è¡¨",
        "è¯å¸ˆ": "è¯å¸ˆæ¶ˆç¾å»¶å¯¿æ³•ä¼šç™»è®°è¡¨",
        "å¤ªå²": "2025 (ä¹™å·³) å¹´å¤ªå²å…‰æ˜ç¯ç™»è®°è¡¨",
      };
      $("dharmaTypeTitle").textContent = dharmaMap[data.dharmaType] || `${data.dharmaType || 'æ³•ä¼š'}ç™»è®°è¡¨`;

      const tbody = $("prayerBody");
      tbody.innerHTML = "";

      let token = 0, fire = 0, pg3 = 0, pg6 = 0;

      for (let i = 0; i < 13; i++) {
        const p = (data.data || [])[i] || {};
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${fillCell(p.name)}</td>
          <td>${fillCell(p.address)}</td>
          <td>${fillCell(p.token)}</td>
          <td>${fillCell(p.fire)}</td>
          <td>${fillCell(p.pg3)}</td>
          <td>${fillCell(p.pg6)}</td>
        `;
        tbody.appendChild(row);

        token += +p.token || 0;
        fire += +p.fire || 0;
        pg3 += +p.pg3 || 0;
        pg6 += +p.pg6 || 0;
      }

      const sponsor = +data.sponsorAmount || 0;
      const tokenAmt = token * 5;
      const fireAmt = fire * 1;
      const pg3Amt = pg3 * 3;
      const pg6Amt = pg6 * 6;
      const total = tokenAmt + fireAmt + pg3Amt + pg6Amt + sponsor;

      function createRow(item, formula, amount) {
        return `
          <div class="total-row">
            <div class="item">${item}</div>
            <div class="formula">${formula}</div>
            <div class="value">RM ${amount.toFixed(2)}</div>
          </div>
        `;
      }

      $("totalBox").innerHTML = `
        ${createRow("ç¥ˆç¦ä»¤ç‰Œ", `5 RM Ã— ${token} ä¸ª`, tokenAmt)}
        ${createRow("å°æŠ¤æ‘©ç‰‡", `1 RM Ã— ${fire} ç‰‡`, fireAmt)}
        ${createRow("çº¸é‡‘ 3", `3 RM Ã— ${pg3} ä»½`, pg3Amt)}
        ${createRow("çº¸é‡‘ 6", `6 RM Ã— ${pg6} ä»½`, pg6Amt)}
        ${createRow("éšå–œèµåŠ©", "", sponsor)}
        <div class="total-row total-final">
          <div class="item">æ€»è®¡</div>
          <div class="formula"></div>
          <div class="value">RM ${total.toFixed(2)}</div>
        </div>
      `;
    });
  </script>
</body>
</html>
